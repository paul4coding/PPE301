<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Calendrier des rendez-vous</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css' rel='stylesheet' />
</head>
<body>
<div class="container my-5">
    <h2 class="mb-4">Calendrier des Rendez-vous</h2>
    <div id='calendar'></div>
    <button class="btn btn-primary mt-4" data-bs-toggle="modal" data-bs-target="#modalRdv">Ajouter un rendez-vous</button>
</div>

<!-- Modal d'ajout de rendez-vous -->
<div class="modal fade" id="modalRdv" tabindex="-1" aria-labelledby="modalRdvLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'ajouter_rendezvous' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="modalRdvLabel">Ajouter un Rendez-vous</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="patient" class="form-label">Patient</label>
            <select name="patient" id="patient" class="form-select" required>
              {% for patient in patients %}
              <option value="{{ patient.id }}">{{ patient }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="medecin" class="form-label">MÃ©decin</label>
            <select name="medecin" id="medecin" class="form-select" required>
              {% for medecin in medecins %}
              <option value="{{ medecin.id }}">{{ medecin }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="date" class="form-label">Date</label>
            <input type="date" name="date" class="form-control" required>
          </div>
          <div class="mb-3">
            <label for="heure" class="form-label">Heure</label>
            <input type="time" name="heure" class="form-control" required>
          </div>
          <div class="mb-3">
            <label for="motif" class="form-label">Motif</label>
            <textarea name="motif" class="form-control" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Enregistrer</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Scripts FullCalendar + Bootstrap -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.js'></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'fr',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      events: '/api/rendezvous/', // URL Django qui renvoie les rendez-vous au format JSON
    });
    calendar.render();
  });
</script>
</body>
</html>

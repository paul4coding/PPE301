{% load static %}
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Toutes les notifications | Tableau de bord</title>
    <meta content="" name="description" />
    <meta content="" name="author" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="{% static 'admin/assets/images/favicon.png' %}" type="image/x-icon" />
    <link rel="apple-touch-icon-precomposed" href="{% static 'admin/assets/images/apple-touch-icon-57-precomposed.png' %}">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="{% static 'admin/assets/images/apple-touch-icon-114-precomposed.png' %}">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="{% static 'admin/assets/images/apple-touch-icon-72-precomposed.png' %}">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="{% static 'admin/assets/images/apple-touch-icon-144-precomposed.png' %}">

    <!-- CORE CSS FRAMEWORK - START -->
    <link href="{% static 'admin/assets/plugins/pace/pace-theme-flash.css' %}" rel="stylesheet" type="text/css" media="screen" />
    <link href="{% static 'admin/assets/plugins/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'admin/assets/plugins/bootstrap/css/bootstrap-theme.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'admin/assets/fonts/font-awesome/css/font-awesome.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'admin/assets/fonts/webfont/cryptocoins.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'admin/assets/css/animate.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'admin/assets/plugins/perfect-scrollbar/perfect-scrollbar.css' %}" rel="stylesheet" type="text/css" />
    <!-- CORE CSS FRAMEWORK - END -->

    <!-- CORE CSS TEMPLATE - START -->
    <link href="{% static 'admin/assets/css/style.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'admin/assets/css/responsive.css' %}" rel="stylesheet" type="text/css" />
    <!-- CORE CSS TEMPLATE - END -->

    <style>
        .notification-card {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            transition: background 0.2s;
        }
        .notification-card.unread {
            background: #f5f8ff;
        }
        .notification-icon {
            font-size: 32px;
            margin-right: 20px;
            color: #467fcf;
            width: 48px;
            text-align: center;
        }
        .notification-content {
            flex: 1;
        }
        .notification-message {
            font-size: 16px;
            font-weight: 500;
        }
        .notification-date {
            font-size: 13px;
            color: #888;
        }
        .notification-link {
            font-size: 14px;
            margin-left: 15px;
        }
        .debug-block {
            background: #ffeeba;
            color: #856404;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 15px;
        }
        .debug-block ul { margin:0; padding-left:18px;}
    </style>
</head>

<body>
    <!-- START TOPBAR -->
    {% include "admin_template/partials/_header.html" %}
    <!-- END TOPBAR -->

    <div class="page-container row-fluid container-fluid">
        <!-- SIDEBAR - START -->
        {% include "admin_template/partials/_sidebar.html" %}
        <!-- SIDEBAR - END -->

        <!-- START CONTENT -->
        <section id="main-content">
            <div class="wrapper main-wrapper row">

                <div class="col-xs-12">
                    <div class="page-title">
                        <div class="pull-left">
                            <h1 class="title">Toutes les notifications</h1>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>

                <div class="col-md-10 col-md-offset-1">
                    <!-- Bloc DEBUG (affiche le nombre de notifications et l'ID du destinataire) -->
                    <div class="debug-block">
                        <b>DEBUG :</b>
                        <br>
                        ID utilisateur connecté : 
                        {% if user.is_authenticated %}
                            {{ user.id }}
                        {% else %}
                            Aucun (utilisateur non connecté)
                        {% endif %}
                        <br>
                        {% if notifications %}
                            Notifications trouvées : {{ notifications|length }}<br>
                            Destinataires des notifications :
                            <ul>
                                {% for n in notifications %}
                                    <li>
                                        ID destinataire : {{ n.destinataire.id }}
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            Aucun résultat pour ce filtre.
                        {% endif %}
                    </div>
                    <!-- Fin DEBUG -->

                    {% if not user.is_authenticated %}
                        <div class="alert alert-warning text-center">
                            Vous n'êtes pas connecté. Connectez-vous pour voir vos notifications.
                        </div>
                    {% endif %}

                    {% if notifications %}
                        {% for notification in notifications %}
                            <div class="notification-card {% if not notification.lu %}unread{% endif %}">
                                <div class="notification-icon">
                                    <i class="fa 
                                        {% if notification.type == 'info' %}fa-info-circle
                                        {% elif notification.type == 'rendezvous' %}fa-calendar
                                        {% elif notification.type == 'message' %}fa-envelope
                                        {% else %}fa-bell
                                        {% endif %}">
                                    </i>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-message">
                                        {{ notification.message|safe }}
                                        {% if notification.lien %}
                                            <a href="{{ notification.lien }}" class="notification-link text-primary"><i class="fa fa-link"></i> Accéder</a>
                                        {% endif %}
                                    </div>
                                    <div class="notification-date">
                                        {{ notification.date|date:"d/m/Y H:i" }} ({{ notification.date|timesince }} ago)
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-info text-center">Aucune notification trouvée.</div>
                    {% endif %}
                </div>
                <div class="clearfix"></div>
            </div>
        </section>
        <!-- END CONTENT -->
    </div>
    <!-- END CONTAINER -->

    <!-- CORE JS FRAMEWORK - START -->
    <script src="{% static 'admin/assets/js/jquery.min.js' %}"></script>
    <script src="{% static 'admin/assets/js/jquery.easing.min.js' %}"></script>
    <script src="{% static 'admin/assets/plugins/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'admin/assets/plugins/pace/pace.min.js' %}"></script>
    <script src="{% static 'admin/assets/plugins/perfect-scrollbar/perfect-scrollbar.min.js' %}"></script>
    <script src="{% static 'admin/assets/plugins/viewport/viewportchecker.js' %}"></script>
    <script>
        window.jQuery || document.write('<script src="{% static 'admin/assets/js/jquery.min.js' %}"><\/script>');
    </script>
    <!-- CORE JS FRAMEWORK - END -->

    <!-- CORE TEMPLATE JS - START -->
    <script src="{% static 'admin/assets/js/scripts.js' %}"></script>
    <!-- END CORE TEMPLATE JS - END -->
</body>
</html>